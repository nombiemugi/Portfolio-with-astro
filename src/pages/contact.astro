---
import Layout from '../layouts/Layout.astro';
import '../styles/global.css';
const pageTitle = "Contact me";
const pageDescription = "Get in Touch with me. I'm always open to discussing new projects, collaboration opportunities, or simply sharing insights. Whether you have a challenging idea or just want to say hello, I'd love to hear from you. You can connect with me through the channels below:";
const continueText = "Alternatively, please feel free to use the contact form provided below. I look forward to connecting with you!";

---

<Layout 
  pageTitle={pageTitle}
  pageDescription={pageDescription}
>
            <section class="m-10">
                <div
                    class="
                    mx-auto
                    px-4 sm:px-6
                    lg:max-w-6/8
                    "
                    >
                <div class="group bg-[var(--color90-lowcontrast)] rounded-2xl border border-border p-6 sm:p-8 space-y-6 transition hover:shadow-[0_0_10px_var(--accent)]">

                    <h1 class="text-2xl sm:text-3xl font-bold text-[var(--accent)] tracking-tight">
                    Contact
                    </h1>
                    <p>
                        {pageDescription} </p>
                        <ul class="flex space-x-4">
                            <li>
                                <a href="https://www.linkedin.com/in/andres-soler-dev/" target="_blank" class="text-[var(--accent)] hover:underline"><strong>LinkedIn</strong> </a>
                            </li>
                            <li>
                                <a href="https://github.com/nombiemugi" target="_blank" class="text-[var(--accent)] hover:underline"><strong>GitHub</strong> </a>
                            </li>
                            <li>
                                <a href="mailto:andressolerdev@gmail.com" target="_blank" class="text-[var(--accent)] hover:underline"><strong>E-Mail</strong> </a>
                            </li>
                        </ul>
                        <p>{continueText}
                    </p>



                    <!-- CONTACT FORM STARTS HERE ðŸ˜­ -->

                    <form
                        id="contact-form" 
                        class="mt-2 space-y-5"
                        name="contact"                 
                        method="POST"
                        netlify-honeypot="bot-field"                 
                        data-netlify="true"
                        data-netlify-recaptcha="true"
                    >
                      <p class="hidden">
                            <label>
                            Donâ€™t fill this out if youâ€™re human: <input name="bot-field" type="text" />
                            </label>
                        </p>
                    <input type="hidden" name="form-name" value="contact" />
    
                    <input type="hidden" name="bot-field" />

                    <!-- Name -->
                    <div class="flex flex-col gap-1">
                        <label class="text-sm font-medium text-muted-foreground">
                        Name
                        </label>
                        <input
                        type="text"
                        name="name"
                        required
                        class="w-full rounded-lg border border-border bg-[var(--color90)] px-4 py-2 text-sm
                                text-foreground placeholder:text-muted-foreground
                                focus:outline-none focus:ring-2 focus:ring-[var(--accent)]
                                transition"
                        placeholder="Your name"
                        />
                    </div>

                    <!-- Email -->
                    <div class="flex flex-col gap-1">
                        <label class="text-sm font-medium text-muted-foreground">
                        Email
                        </label>
                        <input
                        type="email"
                        name="email"
                        required
                        class="w-full rounded-lg border border-border bg-[var(--color90)] px-4 py-2 text-sm
                                text-foreground placeholder:text-muted-foreground
                                focus:outline-none focus:ring-2 focus:ring-[var(--accent)]
                                transition"
                        placeholder="you@email.com"
                        />
                    </div>

                    <!-- Message -->
                    <div class="flex flex-col gap-1">
                        <label class="text-sm font-medium text-muted-foreground">
                        Message
                        </label>
                        <textarea
                        name="message"
                        required
                        rows="4"
                        class="w-full resize-none rounded-lg border border-border bg-[var(--color90)] px-4 py-2 text-sm
                                text-foreground placeholder:text-muted-foreground
                                focus:outline-none focus:ring-2 focus:ring-[var(--accent)]
                                transition"
                        placeholder="Tell me about your project..."
                        ></textarea>
                    </div>
                    <!-- reCAPTCHA   -->
                    <div data-netlify-recaptcha="true"></div>

                    <!-- Submit -->
                    <button
                        type="submit"
                        class="w-full rounded-lg bg-[var(--accent)] px-4 py-2.5 text-sm font-semibold text-black
                            transition-all hover:bg-[var(--accent-glow)]
                            focus:outline-none focus:ring-2 focus:ring-[var(--accent)]
                            active:scale-[0.98]"
                    >
                        Submit
                    </button>
                                        <!-- FORM MESSAGE -->
                    <div id="form-message" role="alert" aria-live="polite" class="my-4 text-center"></div>

                    </form>
                </div>
            </div>
        </section>

        <script>
            // The name of the form in the Netlify dashboard
            const formName = 'contact'; 
            const form = document.getElementById('contact-form');
            const messageContainer = document.getElementById('form-message');

            const encode = (data) => {
                return Object.keys(data)
                    .map(key => encodeURIComponent(key) + "=" + encodeURIComponent(data[key]))
                    .join("&");
            }

            const handleSubmit = async (event) => {
                event.preventDefault();
                
                // 1. Clear any existing messages
                messageContainer.innerHTML = '';

                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());

                try {
                    const response = await fetch("/", {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        // Netlify requires data in this specific format for AJAX
                        body: encode({ "form-name": formName, ...data }) 
                    });

                    if (response.ok) {
                        // SUCCESS: Display success message and clear form
                        messageContainer.innerHTML = '<p class="text-green-500 font-semibold">Thank you! Your message has been sent.</p>';
                        form.reset(); 
                    } else {
                        // ERROR: Display failure message
                        messageContainer.innerHTML = '<p class="text-red-500 font-semibold">Error: Could not send message. Please try again.</p>';
                    }
                } catch (error) {
                    // NETWORK ERROR: Display failure message
                    messageContainer.innerHTML = '<p class="text-red-500 font-semibold">A network error occurred. Please check your connection.</p>';
                }
            };

            // Attach the handler to the form
            form.addEventListener("submit", handleSubmit);
        </script>

